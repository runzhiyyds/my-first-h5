(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))h(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function h(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();const i=document.getElementById("particle-canvas"),r=i.getContext("2d");function v(){i.width=window.innerWidth,i.height=window.innerHeight}v();window.addEventListener("resize",v);const E=[],P=60;for(let e=0;e<P;e++)E.push({x:Math.random()*i.width,y:Math.random()*i.height,size:Math.random()*2+1,speedX:(Math.random()-.5)*.4,speedY:(Math.random()-.5)*.4,alpha:Math.random()*.5+.3});function I(){r.clearRect(0,0,i.width,i.height),E.forEach(e=>{e.x+=e.speedX,e.y+=e.speedY,e.x<0&&(e.x=i.width),e.x>i.width&&(e.x=0),e.y<0&&(e.y=i.height),e.y>i.height&&(e.y=0),r.fillStyle=`rgba(255, 220, 120, ${e.alpha})`,r.beginPath(),r.arc(e.x,e.y,e.size,0,Math.PI*2),r.fill()}),requestAnimationFrame(I)}I();const S=document.getElementById("role-select-screen"),w=document.getElementById("game-screen"),N=document.getElementById("ending-screen"),K=document.querySelectorAll(".role-card"),l=document.getElementById("upper-bg"),m=document.getElementById("lower-bg"),O=document.getElementById("budget-bar"),z=document.getElementById("main-bar"),T=document.getElementById("budget-num"),k=document.getElementById("main-num"),q=document.getElementById("role-main-value-name"),$=document.getElementById("event-title"),y=document.getElementById("optionA"),x=document.getElementById("optionB"),u=document.getElementById("ending-text"),F=document.getElementById("restart-btn");let g=null,d=60,a=60,f=0;const p=["/images/party1.jpg","/images/party2.jpg","/images/party3.jpg","/images/dancer.jpg","/images/glassgirl.jpg"],B=["/images/foodline1.jpg","/images/foodline2.jpg","/images/foodline3.jpg"],L={planner:{name:"派对组织者",mainKey:"声望",start:65,events:[{title:"舞者提出使用干冰烟雾增强效果",A:{text:"同意：更震撼",budget:-5,main:10},B:{text:"拒绝：安全优先",budget:0,main:-5}},{title:"宾客要求加开烟花秀",A:{text:"满足要求",budget:-12,main:14},B:{text:"委婉拒绝",budget:0,main:-10}},{title:"舞会录像曝光，引发外界讨论",A:{text:"公关处理",budget:-10,main:-4},B:{text:"不处理",budget:0,main:-10}}]},staff:{name:"白宫幕僚",mainKey:"政府信任度",start:55,events:[{title:"媒体指控政府无视食品券危机",A:{text:"召开新闻发布会",budget:-10,main:8},B:{text:"拖延回应",budget:0,main:-10}},{title:"机场延误引发舆论爆炸",A:{text:"投入临时预算提升人手",budget:-15,main:12},B:{text:"保持沉默",budget:0,main:-15}}]},family:{name:"SNAP 家庭",mainKey:"生存度",start:45,events:[{title:"食品券暂时中断，你需要决定今天的食物来源",A:{text:"排队领取救援食物",budget:0,main:5},B:{text:"节省食用剩余物资",budget:0,main:-3}},{title:"社区志愿者提供一包食物，但数量有限",A:{text:"全部带走",budget:0,main:8},B:{text:"分给其他家庭",budget:0,main:2}}]}};K.forEach(e=>{e.addEventListener("click",()=>{g=e.dataset.role;const o=L[g];a=o.start,o.mainKey,S.classList.add("hidden"),w.classList.remove("hidden"),q.textContent=o.mainKey,A(),C(),M(),j()})});function A(){O.style.width=d+"%",z.style.width=a+"%",T.textContent=d,k.textContent=a}function C(){const o=L[g].events;if(f>=o.length){R();return}const s=o[f];$.textContent=s.title,y.textContent=s.A.text,x.textContent=s.B.text,y.onclick=()=>b(s.A),x.onclick=()=>b(s.B)}function b(e){d+=e.budget,a+=e.main,d<0&&(d=0),a<0&&(a=0),a>100&&(a=100),A(),f++,M(),j(),C()}function M(){const e=p[Math.floor(Math.random()*p.length)];l.style.backgroundImage=`url(${e})`,l.classList.remove("active"),setTimeout(()=>l.classList.add("active"),30)}function j(){const e=B[Math.floor(Math.random()*B.length)];m.style.backgroundImage=`url(${e})`,m.classList.remove("active"),setTimeout(()=>m.classList.add("active"),30)}function R(){w.classList.add("hidden"),N.classList.remove("hidden"),a<=20?u.textContent="现实无情，结局沉重。你未能改变走向。":a>=80?u.textContent="你成功在混乱中撑起了一个世界的希望。":u.textContent="风波暂告一段，但真正的故事仍未结束。"}F.addEventListener("click",()=>{location.reload()});
